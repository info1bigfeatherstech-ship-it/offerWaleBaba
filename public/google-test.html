<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Continue with Google - OfferWaaleBaba</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fb;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 400px;
      text-align: center;
    }

    h1 {
      margin-bottom: 10px;
    }

    #buttonDiv {
      margin-top: 20px;
    }

    .status {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .success {
      background: #d4edda;
      color: #155724;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
    }

    .loading {
      background: #e2e3e5;
      color: #383d41;
    }

  </style>
</head>
<body>

<div class="container">
  <h1>OfferWaaleBaba</h1>
  <p>Sign in with Google</p>

  <div id="buttonDiv"></div>

  <div id="statusBox" class="status"></div>
</div>

<!-- Google Script -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
  const GOOGLE_CLIENT_ID = "223957179302-n5n8lt57hhrr3clidhcv687kjmkeli28.apps.googleusercontent.com";

  const statusBox = document.getElementById("statusBox");

  function showStatus(message, type) {
    statusBox.style.display = "block";
    statusBox.className = "status " + type;
    statusBox.innerHTML = message;
  }

  window.onload = function () {
    google.accounts.id.initialize({
      client_id: GOOGLE_CLIENT_ID,
      callback: handleCredentialResponse
    });

    google.accounts.id.renderButton(
      document.getElementById("buttonDiv"),
      {
        theme: "outline",
        size: "large",
        text: "continue_with"
      }
    );
  };

  async function handleCredentialResponse(response) {
    const idToken = response.credential;

    showStatus("Signing you in...", "Loading");

    try {
      const apiResponse = await fetch("http://localhost:8081/api/auth/google", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        credentials: "include",
        body: JSON.stringify({ idToken })
      });

      const data = await apiResponse.json();

      if (!apiResponse.ok) {
        throw new Error(data.message || "Login Failed");
      }

      console.log("Backend Response:", data);

      // Store access token (demo purpose)
      localStorage.setItem("accessToken", data.accessToken);

      showStatus("Login Successful! Redirecting...", "Success");

      // Redirect after 1.5 sec
      setTimeout(() => {
        window.location.href = "dashboard.html";
      }, 1500);

    } catch (error) {
      console.error("Login Error:", error);
      showStatus("Login Failed: " + error.message, "error");
    }
  } 
</script>
</body>
</html>